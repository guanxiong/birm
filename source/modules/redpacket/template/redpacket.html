{template 'common/header'}

<ul class="nav nav-tabs">
	<li {if $operation== 'post'}class="active"{/if}><a
		href="{php echo create_url('site/module/packet', array('name' => 'redpacket', 'op' => 'post'));}">添加</a></li>
	<li {if $operation== 'display'}class="active"{/if}><a
		href="{php echo create_url('site/module/packet', array('name' => 'redpacket', 'op' => 'display'));}">管理</a></li>

</ul>
{if $operation == 'post'}
<div class="main">
	<form action="" method="post" class="form-horizontal form"
		enctype="multipart/form-data">
		<input type="hidden" name="id" value="{$item['id']}" />
		<h4>名称</h4>
		<table class="tb">

			<tr>
				<td><label for="">活动设置</label></td>
				<td>
					<div class="alert alert-block alert-new">
						<table class="tb">
							<tr>
								<th><label for="">活动名称</label></th>
								<td><input type="text" name="rname" class="span5" value="{$item['name']}" /></td>
							</tr>

							<tr>
								<th><label for="">活动红包摘要(红包图片下方提示文字)</label></th>
								<td><input type="text" name="packetsummary" class="span5" value="{$item['packetsummary']}" /></td>
							</tr>

							<tr>
								<th><label for="">分享小提示(红包下方法分享提示)</label></th>
								<td><input type="text" name="sharetip" class="span5" value="{$item['sharetip']}" /></td>
							</tr>

							<tr>
								<th><label for="">好友翻牌小提示(手机好友翻牌下面小提示)</label></th>
								<td><input type="text" name="fanpaitip" class="span5" value="{$item['fanpaitip']}" /></td>
							</tr>

							<tr>
								<th><label for="">中奖小提示说明(中奖页下发提示)</label></th>
								<td><input type="text" name="awardtip" class="span5" value="{$item['awardtip']}" /></td>
							</tr>
							<tr>
								<th><label for="">活动人数限制</label></th>
								<td><input type="text" name="countlimit" class="span5" value="{$item['countlimit']}" /></td>
							</tr>
							<tr>
								<th><label for="">排行帮显示前</label></th>
								<td>
									<div class="input-append input-prepend" style="float: left">
										<input type="text" name="sortcount" class="span5" value="{$item['sortcount']}" /> <span class="add-on">名</span>
									</div>
								</td>
							</tr>

							<tr>
								<th><label for="">活动开始时间</label></th>
								<td>{php echo tpl_form_field_date('begintime', $item['begintime'],true)}</td>
							</tr>

							<tr>
								<th><label for="">活动结束时间</label></th>
								<td>{php echo tpl_form_field_date('endtime', $item['endtime'],true)}</td>
							</tr>

							<tr>
								<th><label for="">活动banner图片</label></th>
								<td>{php echo tpl_form_field_image('banner_pic',$item['banner_pic']);} <font>建议(宽高340*80)</font>
								</td>
							</tr>
							<tr>
								<th><label for="">抽奖卡片吧背景图片</label></th>
								<td>{php echo tpl_form_field_image('cardbg',$item['cardbg'],$this->cardbg());}
									<font>建议(宽高150*210)</font>
								</td>
							</tr>


							<tr>
								<th><label for="">活动规则说明</label></th>
								<td>
									<textarea style="height: 400px; width: 100%;" class="span7 richtext-clone" name="rule" cols="70">{$item['rule']}</textarea>
								</td>
							</tr>

							<tr>
								<th><label for="">关注按钮文字</label></th>
								<td><input type="text" name="carebtn" class="span5" value="{$item['carebtn']}" /></td>
							</tr>

							<tr>
								<th><label for="">关注引导链接地址:</label></th>
								<td><input type="text" class="form-control span5" placeholder="关注引导素材" name="careurl" value="{$item['careurl']}" /></td>
							</tr>


							<tr>
								<th><label for="">邀请好友攒钱文字</label></th>
								<td><input type="text" name="sharebtn" class="span5" value="{$item['sharebtn']}" /></td>
							</tr>

							<tr>
								<th><label for="">好友帮助邀请攒钱文字</label></th>
								<td><input type="text" name="fsharebtn" class="span5" value="{$item['fsharebtn']}" /></td>
							</tr>
						</table>
					</div>
				</td>
			</tr>


			<!-- 翻牌设置 -->
			<tr>
				<td>翻牌规则设置</td>
				<td>
					<div class="alert alert-block alert-new">
						<table class="tb">
							<tr>
								<th><label for="">最高金额限制</label></th>
								<td><input type="number" class="form-control" placeholder="最高金额" name="incomelimit" value="{$item['incomelimit']}" /></td>
							</tr>
							<tr>
								<th><label for="">初始金额</label></th>
								<td><input type="number" class="form-control" placeholder="初始金额" name="start" value="{$item['start']}" /></td>
							</tr>

							<tr>
								<th><label for="">每个好友总翻牌次数限制</label></th>
								<td><input type="text" name="totallimit" class="span5" value="{$item['totallimit']}" /><span class="add-on">次</span>
									<font color='red'>(总翻牌数限制类型)</font></td>
							</tr>

							<tr>
								<th><label for="">每个友每天翻牌次数</label></th>
								<td><input type="text" name="daylimit" class="span5" value="{$item['daylimit']}" /><span class="add-on">次</span>
									<font color='red'>(每天翻牌限制类型 )</font></td>
							</tr>



							<tr>
								<th><label for="">限制类型</label></th>
								<td><input type="radio" name="limitType" value="0"
									{if $item['limitType'] == 0}checked="checked"{/if}>总翻牌数限制&nbsp;&nbsp;
									<input type="radio" name="limitType" value="1"
									{if $item['limitType'] == 1}checked="checked"{/if}>每天翻牌限制
								</td>
							</tr>

							<tr>
								<th><label for="">固定翻牌金额</label></th>
								<td><input type="number" class="form-control"
									placeholder="助力积分" name="step" value="{$item['step']}" /></td>
							</tr>

							<tr>
								<th><label for="">随机翻牌金额</label></th>
								<td><input type="number" class="form-control"
									placeholder="助力积分" name="steprandom" value="{$item['steprandom']}" /></td>
							</tr>

							<tr>
								<th><label for="">翻牌金额方式</label></th>
								<td><input type="radio" name="steptype" value="0"
									{if $item['steptype'] == 0}checked="checked"{/if}> 固定&nbsp;&nbsp;&nbsp; <input type="radio" name="steptype" value="1" {if $item['steptype'] == 1}checked="checked"{/if}>随机
								</td>
							</tr>

							<tr>
								<th><label for="">增加金额概率</label></th>
								<td><input type="number" class="form-control" placeholder="增加金额概率" name="addp" value="{$item['addp']}" />%(0-100)
								</td>
							</tr>
						</table>
					</div>
				</td>
			</tr>

			<!-- 奖品设置 -->
			<tr>
				<td><span class='red'>*</span>奖品设置：</td>
				<td>
					<div class="alert alert-block alert-new" style='width: 500px;'>
						<table>
							<thead>
								<tr>
									<th>点数(大于此金额)</th>
									<th>奖品名称</th>
									<th>奖品数量</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="award-items">
								{loop $awards $award}
								<tr class='award_item'>
									<td><input name="award_point[]" type="text"
										class="form-control span2" value="{$award['point']}"
										maxlength="50" /></td>
									<td><input name="award_name[]" type="text"
										class="form-control span2" value="{$award['name']}"
										maxlength="10" style="width: 100px;" /></td>
									<td><input name="award_num[]" type="text"
										class="form-control span2" value="{$award['num']}"
										maxlength="50" /></td>
									<td><input name="award_id[]" type="hidden"
										value="{$award['id']}" /> <a href='javascript:;'
										onclick='removeAward(this)'><i
											class='icon icon-remove fa fa-times'></i> 删除</a></td>
								</tr>
								{/loop}
							</tbody>
						</table>
					</div>
				</td>
			</tr>

			<tr>
				<th></th>
				<td><a href="javascript:;" onclick="addAward();"><i class="icon-plus-sign" title="添加奖品"></i> 添加奖品</a></td>
			</tr>

			<!-- 分享设置 -->
			<tr>
				<td><label for="">分享设置:</label></td>
				<td>
					<div class="alert alert-block alert-new">
						<table class="tb">
							<tr>
								<th><label for="">分享标题</label></th>
								<td><input type="text" name="shareTitle" class="span5" value="{$item['shareTitle']}" /></td>
							</tr>

							<tr>
								<th><label for="">分享图标</label></th>
								<td>{php echo tpl_form_field_image('shareImg',$item['shareImg']);}</td>
							</tr>

							<tr>
								<th><label for="">分享说说明</label></th>
								<td><textarea rows="3" cols="20" id="shareContent" name="shareContent">{$item['shareContent']}</textarea></td>
							</tr>
						</table>
					</div>
				</td>
			</tr>

			<tr>
				<th></th>
				<td><input name="submit" type="submit" value="提交" 	class="btn btn-primary span3"> <input type="hidden"
					name="token" value="{$_W['token']}" /></td>
			</tr>
		</table>
	</form>
</div>
<script type="text/javascript">
<!--
	kindeditor($('.richtext-clone'));
	//-->
	function addAward() {
		var html = " <tr class='award_item'>";
		html += "<td><input  name='award_point[]' type='text' class='form-control span2' value=''  maxlength='50'/></td>";
		html += "<td><input  name='award_name[]' type='text' class='form-control span2' value=''  maxlength='50'/></td> ";
		html += "<td><input  name='award_num[]' type='text' class='form-control span2' value=''  maxlength='3'/></td>";
		html += "<td>";
		html += "<input  name='award_id[]' type='hidden' value='' />";
		html += "<a href='javascript:;' onclick='removeAward(this)'><i class='icon icon-remove fa fa-times'></i> 删除</a>";
		html += "</td>";
		html += "</tr>";
		$("#award-items").append(html);
	}
	function removeAward(obj) {
		$(obj).parent().parent().remove();
	}
</script>
{elseif $operation == 'display'}
<div class="main">
	<div class="alert alert-error">请务必正确配置公众账号的AppId 和AppSecret
		的值,并配置OAUTH2.0 授权回调页面域名。订阅号可以借用服务号的appId 和appSecret值，但服务号的授权域名需填写本系统站点域名。</div>
	<div style="padding: 15px;">
		<table class="table table-hover">
			<thead class="navbar-inner">
				<tr>
					<th style="min-width: 100px;">活动名称</th>
					<th style="width: 180px;">活动开始时间</th>
					<th style="width: 180px;">活动结束时间</th>
					<th style="text-align: right; min-width: 300px;">操作</th>
				</tr>
			</thead>
			<tbody>
				{loop $list $item}
				<tr>
					<td><a href='{php echo $this->createMobileUrl('index',array("id"=>$item['id']))}' target='_blank'>{$item['name']}</a></td>
					<td>{php echo date('Y-m-d H:i', $item['begintime'])}</td>
					<td>{php echo date('Y-m-d H:i', $item['endtime'])}</td>
					<td style="text-align: right; width: 400px">
						<a href="{php echo create_url('site/module/fanslist', array('name' => 'redpacket', 'pid' => $item['id']))}" title="报名用户" class="btn btn-small">领取用户<i class="icon-user"></i>
						</a>
						<a href="{php echo create_url('site/module/packet', array('name' => 'redpacket', 'id' => $item['id'], 'op' => 'post'))}" title="编辑" class="btn btn-small"><i class="icon-edit"></i>
						</a> 
						<a href="{php echo create_url('site/module/packet', array('name' => 'redpacket', 'id' => $item['id'], 'op' => 'delete'))}"
						onclick="return confirm('此操作不可恢复，确认删除？');return false;" title="删除" class="btn btn-small"><i class="icon-remove"></i>
						</a>
					</td>
				</tr>
				{/loop}
			</tbody>

		</table>
		{$pager}
	</div>
</div>
{/if} {template 'common/footer'}
