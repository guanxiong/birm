<!DOCTYPE html>
<html>
    <head>
        <title>{php echo $title}</title>
        <meta charset="utf-8">
        <meta name="keywords" content="微投票, By回忆QQ125879930" />
        <meta name="description" content="微投票, By回忆QQ125879930" />
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">


        <link href="./source/modules/weivote/template/mobile/assest/css/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" />
        <link href="./source/modules/weivote/template/mobile/assest/css/se7en-font.css" media="all" rel="stylesheet" type="text/css" />
        <link href="./source/modules/weivote/template/mobile/assest/css/jquery.fancybox.css" media="all" rel="stylesheet" type="text/css" />
        <link href="./source/modules/weivote/template/mobile/assest/css/style.css" media="all" rel="stylesheet" type="text/css" />
        
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery-1.10.2.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery-ui.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.bootstrap.wizard.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/fullcalendar.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.datatables.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.easy-pie-chart.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.isotope.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/modernizr.custom.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.fancybox.pack.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/select2.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.inputmask.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.validate.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/bootstrap-fileupload.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/bootstrap-timepicker.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/bootstrap-colorpicker.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/daterange-picker.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/date.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/fitvids.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/jquery.sparkline.min.js" type="text/javascript"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/main.js" type="text/javascript"></script>

        <script src="./source/modules/weivote/template/mobile/assest/js/jqBootstrapValidation.js"></script>
        <script src="./source/modules/weivote/template/mobile/assest/js/bounce.js"></script>  



        <style type="text/css">
        /* Mini layout previews
        -------------------------------------------------- */
        .mini-layout,
        .mini-layout .mini-layout-body,
        .mini-layout.fluid .mini-layout-sidebar {
          /*height: 300px;*/
          margin-bottom: 10px;
        }
        .mini-layout div {
          -webkit-border-radius: 3px;
             -moz-border-radius: 3px;
                  border-radius: 3px;
        }
        .mini-layout .mini-layout-body {
          margin: 0 auto;
          width: 48%;
        }
        .mini-layout.fluid .mini-layout-sidebar,
        .mini-layout.fluid .mini-layout-header,
        .mini-layout.fluid .mini-layout-body {
          float: left;
        }
        .mini-layout.fluid .mini-layout-sidebar {
          width: 48%;
        }
        .mini-layout.fluid .mini-layout-body {
          width: 48%;
          margin-left: 4%;
        }
        </style>
    </head>
    
    <body>
        <div class="modal-shiftfix">
            <!-- Navigation -->
            <div class="navbar navbar-fixed-top scroll-hide">
                <div class="container-fluid top-bar">
                    <button id="btn-nav" class="navbar-toggle">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <h4 style="float: right; margin: 13px 5px 0 50px;">
                        {php echo $title}
                    </h4>
                </div>
                <div class="container-fluid main-nav clearfix">
                    <div class="nav-collapse">
                        <ul class="nav">
                            <li>
                                <a id="a-vote" href="#" onclick="showSomething('vote');cancelNav();return false;">
                                    <span aria-hidden="true" class="se7en-star"></span>投票
                                </a>
                            </li>
                            <li>
                                <a id="a-result" href="#" onclick="toResult();cancelNav();return false;">
                                    <span aria-hidden="true" class="se7en-charts"></span>查看结果
                                </a>
                            </li>
                            <li>
                                <a id="a-register" href="#" onclick="showSomething('register');cancelNav();return false;">
                                    <span aria-hidden="true" class="se7en-feed"></span>登记信息
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- End Navigation -->


            <!-- Main -->
            <div class="container-fluid main-content">
                
                <div class="container" style="padding-right: 0px;padding-left: 0px;">
                    
                    <div class="col-lg-12">


                      <!-- Register -->

                      <div id="div-register" style="display:none;">

                      {if $member['realname']}
                      <div class="row">
                        <div class="span12">
                          <div class="well well-form txt-lefty">
                            <h3>您已经登记完成</h3>
                            <p>
                              您已经登记完成，以后无需登记可直接参与微投票！如果需要修改信息，请再次提交更改。
                            </p>
                          </div>
                        </div>  
                      </div>
                      {else}
                      <div class="row">
                        <div class="span12">
                          <div class="well well-form txt-lefty">
                            <h3>微投票相关说明</h3>
                            <p>
                              尊敬的用户您好，欢迎使用微投票，参与用户请务必认真填写您的个人信息，以便我们及时准确的将信息发送给您！谢谢！祝您工作顺利！
                            </p>      
                          </div>
                        </div>  
                      </div>    
                      {/if}

                      <hr/>

                      <div class="row">
                      <div class="span12">
                        <div class="well well-form txt-lefty">
                          <h3>信息登记</h3>
                          <form id="frm-register">

                            <input type="hidden" name="id" value="{$_GPC['id']}" />
                            <input type="hidden" name="token" value="{$_W['token']}" />

                            <div class="control-group" style="margin-bottom: 10px;">
                              <div class="controls">
                              <div class="input-prepend input-group">
                                <span class="input-group-addon">姓名</span>
                                <input  type="text" name="realname" placeholder="姓名" class="form-control"
                                        required=""
                                        data-validation-required-message="请输入您的真实姓名！"
                                        value="{php echo $member['realname']}" />
                              
                              </div>
                              </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px;"> 
                              <div class="controls">
                              <div class="input-prepend input-group">
                                <span class="input-group-addon">手机</span>
                                <input  type="text" name="mobile" placeholder="手机" class="form-control" 
                                        required=""
                                        data-validation-required-message="请输入您的手机号码！"
                                        data-validation-uppercase-regex="^1[358]{1}[0-9]{9}" 
                                        data-validation-uppercase-message="请输入正确的手机号码！" 
                                        value="{php echo $member['mobile']}" />
                              </div>
                              </div>      
                            </div>
                            <div class="control-group" style="margin-bottom: 10px;"> 
                              <div class="controls">
                              <div class="input-prepend input-group">
                                <span class="input-group-addon">Q&nbsp;&nbsp;Q</span>
                                <input  type="text" name="qq" placeholder="QQ" class="form-control" 
                                        required=""
                                        data-validation-required-message="请输入您的QQ号码！"
                                        value="{php echo $member['qq']}" />
                              </div>
                              </div>      
                            </div>
                            
                            <div class="form-actions">
                              <button class="btn btn-primary" onclick="registerSubmit(); return false;">提交登记</button>
                            </div> 
                          </form>       
                        </div>  
                      </div>    
                      </div>

                      </div>
                      <!-- Register End -->



                      <!-- Header -->
                      <div id="div-header" class="widget-container fluid-height clearfix" style="display:none;">
                        
                        <div class="heading-top">
                          <img alt="正在加载..." class="Jimgload" src="./source/modules/weivote/template/mobile/assest/images/loading.gif" xsrc="{php echo $cover}" width="100%" />
                          <!--活动描述-->
                          <p>{php echo $weivote_setting['description']}</p>
                        </div>

                        <div class="widget-content padded">
                          <h5 id="h5-header-voter_count">当前已有{php echo $voter_count}名用户参与此活动</h5>
                        </div>
                      </div>
                      <!-- Header End -->


                      <!-- Vote -->
                      <div id="div-vote" style="display:none;">

                        <form id="frm-vote" action="#">
                            <input type="hidden" name="id" value="{$_GPC['id']}" />
                            <input type="hidden" name="token" value="{$_W['token']}" />

                      <div class="widget-container fluid-height clearfix">
                        <div class="widget-content padded" style="font-size: 16px;">
                          
                          <!-- 初始化 -->
                          {php $option_index = 0;}


                          <div class="mini-layout fluid">
                          <!-- 单选 -->
                          {if $weivote_setting['max_vote_day'] == 1}
                            {loop $weivote_options $weivote_option}

                                <!-- 图片Vote -->
                                {if $weivote_option['picture'] != ''}
                                    {if $option_index % 2 == 0}
            
                                            <div class="mini-layout-sidebar">
                                                
                                                <div class="thumbnail" style="margin-bottom: 0px;">
                                                    <a href="#" onclick="toVoter({php echo $weivote_option['id']});return false;">
                                                      <img alt="正在加载..." width="99%" class="Jimgload" src="./source/modules/weivote/template/mobile/assest/images/loading.gif" xsrc="{php echo $_W['attachurl'].$weivote_option['picture']}" />
                                                    </a>
                                                    <div class="caption">

                                                        <label class="radio"><input name="options-choose[]" type="radio" value="{php echo $weivote_option['id']}"><span>{php echo $weivote_option['title']}</span></label>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                    {else}
                                            <div class="mini-layout-body">
                                
                                                <div class="thumbnail" style="margin-bottom: 0px;">
                                                    <a style="margin-bottom: 0px;" href="#" onclick="toVoter({php echo $weivote_option['id']});return false;">
                                                      <img alt="正在加载..." width="99%" class="Jimgload" src="./source/modules/weivote/template/mobile/assest/images/loading.gif" xsrc="{php echo $_W['attachurl'].$weivote_option['picture']}" />
                                                    </a>
                                                    <div class="caption">
                                                        <label class="radio"><input name="options-choose[]" type="radio" value="{php echo $weivote_option['id']}"><span>{php echo $weivote_option['title']}</span></label>
                                                    </div>
                                                </div>
                                                
                                            </div>
                            
                                            <div style="clear:both;"></div>
                                        
                                    {/if}

                                <!-- 文字Vote -->
                                {else}
                                    <div class="thumbnail" style="margin-bottom: 10px;">
                                        <label class="radio"><input name="options-choose[]" type="radio" value="{php echo $weivote_option['id']}"><span>{php echo $weivote_option['title']}</span></label>
                                    </div>
                                {/if}

                            {php $option_index++;}
                            {/loop}
                          
                          {/if}

                          <!-- 多选 -->
                          {if $weivote_setting['max_vote_day'] >= 2}
                            {loop $weivote_options $weivote_option}

                                <!-- 图片Vote -->
                                {if $weivote_option['picture'] != ''}
                                    {if $option_index % 2 == 0}
            
                                            <div class="mini-layout-sidebar">
                                                
                                                <div class="thumbnail" style="margin-bottom: 0px;">
                                                    <a href="#" onclick="toVoter({php echo $weivote_option['id']});return false;">
                                                      <img alt="正在加载..." width="99%" class="Jimgload" src="./source/modules/weivote/template/mobile/assest/images/loading.gif" xsrc="{php echo $_W['attachurl'].$weivote_option['picture']}" />
                                                    </a>
                                                    <div class="caption">
                                                        <label class="checkbox"><input type="checkbox" name="options-choose[]" value="{php echo $weivote_option['id']}"><span>{php echo $weivote_option['title']}</span></label>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                    {else}
                                            <div class="mini-layout-body">
                                
                                                <div class="thumbnail" style="margin-bottom: 0px;">
                                                    <a style="margin-bottom: 0px;" href="#" onclick="toVoter({php echo $weivote_option['id']});return false;">
                                                      <img alt="正在加载..." width="99%" class="Jimgload" src="./source/modules/weivote/template/mobile/assest/images/loading.gif" xsrc="{php echo $_W['attachurl'].$weivote_option['picture']}" />
                                                    </a>
                                                    <div class="caption">
                                                        <label class="checkbox"><input type="checkbox" name="options-choose[]" value="{php echo $weivote_option['id']}"><span>{php echo $weivote_option['title']}</span></label>
                                                    </div>
                                                </div>
                                                
                                            </div>
                            
                                            <div style="clear:both;"></div>
                                        
                                    {/if}

                                <!-- 文字Vote -->
                                {else}
                                    <div class="thumbnail" style="margin-bottom: 10px;">
                                        <label class="radio" for="option1">
                                            <label class="checkbox"><input type="checkbox" name="options-choose[]" value="{php echo $weivote_option['id']}"><span>{php echo $weivote_option['title']}</span></label>
                                        </label>
                                    </div>
                                {/if}

                            {php $option_index++;}
                            {/loop}
                          {/if}
                          </div>

                        </div>
                      </div>



                      <div class="widget-container fluid-height clearfix">
                        <div class="widget-content padded" style="text-align: center;">                          
                          <button class="btn btn-primary" style="width: 100%;" onclick="voteSubmit(); return false;">提交</button>
                        </div>
                      </div>


                        </form>
                      </div>
                      <!-- Vote End -->



                      


                      <!-- Voter -->
                      <div id="div-voter" style="display:none;">
                        <form id="frm-voter">
                          <input type="hidden" name="id" value="{$_GPC['id']}" />
                          <input type="hidden" name="token" value="{$_W['token']}" />
                          <input type="hidden" name="options-choose[]" id="hid-voter-options-choose">

                      <div class="widget-container fluid-height clearfix">
                        <div class="widget-content padded">

                          <div class="thumbnail">
                              <a href="#">
                                <img id="img-voter" alt="image" width="99%"/>
                              </a>
                              <div class="caption">
                                <h3 id="h3-voter">
                                  冯诺尔曼结构
                                </h3>
                                <p id="p-voter">也称普林斯顿结构，是一种将程序指令存储器和数据存储器合并在一起的存储器结构。程序指令存储地址和数据存储地址指向同一个存储器的不同物理位置。
                                </p>
                              </div>
                          </div>
          
                          <div style="clear:both;"></div>

                        </div>
                      </div>


                      <div class="widget-container fluid-height clearfix">
                        <div class="widget-content padded" style="text-align: center;">                          
                          <button class="btn btn-primary" style="width: 100%;" onclick="voterSubmit(); return false;">投一票</button>      
                          <button class="btn btn-default" style="width: 100%;" onclick="showVote();return false;">返&nbsp;&nbsp;回</button>
                        </div>
                      </div>
                      </div>
                      <!-- Voter End -->


                      <!-- Description -->


                      <div id="div-desc" class="widget-container fluid-height clearfix" style="display:none;">
                        <div class="widget-content padded">                          
                          <h5>说明：</h5>
                          <h6>1.投票时间：{php echo date('Y-m-d H:i', $weivote_setting['start_time'])} 至 {php echo date('Y-m-d H:i', $weivote_setting['end_time'])}</h6>
                          <h6>2.投票规则：<br>
                              每个微信号每天可投{php echo $weivote_setting['max_vote_day']}票；<br>
                              每个微信号本次投票活动总投票上限{php echo $weivote_setting['max_vote_count']}票; <br>
                              每个微信号{if $weivote_setting['type_vote'] == '1'}不可{else}可以{/if}重复投同一选项;<br>
                              可即时查看实时投票结果。</h6>
                        </div>
                      </div>

                      <!-- Description End -->


                      <!-- Result -->
                      <div id="div-result" style="display:none;">
                      <div class="widget-container fluid-height clearfix">
              
                        <div class="heading-top">
                          <h5><b>{php echo $weivote_setting['title']}</b></h5>
                        
                          <ul style="margin-left: -20px;">
                              <li>实时参与人数：<b id="b-result-voter_count">{php echo $voter_count}</b></li>
                              <li>实时总投票数：<b id="b-result-options_count">{php echo $options_count}</b></li>
                              <li>开始日期：<b>{php echo date('Y-m-d H:i', $weivote_setting['start_time'])}</b></li>
                              <li>结束日期：<b>{php echo date('Y-m-d H:i', $weivote_setting['end_time'])}</b></li>
                          </ul>
                        </div>
                      </div>



                      <div class="widget-container fluid-height clearfix">
                        <div class="widget-content padded" id="div-result-option">

                          
                          <div class="mini-layout fluid">            
                            <div class="mini-layout-sidebar">                                
                                <div class="thumbnail">
                                    
                                      <img alt="正在加载..." width="99%" src="6.jpg" />
                                    
                                </div>                                
                            </div>            
                            <div class="mini-layout-body">                                
                              <p style="font-size: 18px; color: #777; text-align: left;">

                                姓名<br>
                                票数：10011<br>
                                占比：85.5%

                              </p>                                
                            </div>
                            <div style="clear:both;"></div>
                            <div class="progress progress-striped active" style="height: 30px;">

                              <div class="progress-bar" style="width: 50%; font-size:20px;">50%</div>

                            </div>
            
                            <div style="clear:both;"></div>
                          </div>


                        </div>
                      </div>

                      </div>
                      <!-- Result End -->

                      
                      <!-- Footer -->  
                      <div id="div-footer" class="widget-container fluid-height clearfix" style="display:none;">
                        <div class="widget-content padded">
                        {php echo $weivote_setting['rule']}
                        </div>
                      </div>
                      <!-- Footer End -->
                      
                      

                    </div>

                </div>

            </div>
            <!-- End Main -->

            <!-- CopyWight -->
            <div id="copywrite" style="background: none repeat scroll 0 0 #fefefe; color: #555555; padding: 0 20px;">
              <div class="container">
                <div class="row">
                    <p style="padding: 10px 0; margin: 0; font-family: 'Helvetica Neue','Helvetica',Arial,Verdana,sans-serif;">&copy; 2014 {$_W['account']['name']}</p>   

                </div>
              </div>    
            </div>
            <!-- CopyWight End -->





            <a class="btn btn-primary btn" data-toggle="modal" id="modal-QQ125879930" href="#modal-container-QQ125879930" style="display:none;"></a>

            <div class="modal fade" id="modal-container-QQ125879930">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
                    <h4 class="modal-title">
                      温馨提示
                    </h4>
                  </div>
                  <div class="modal-body">
                    <p id="p-modal-alert">{php echo $alert_msg}</p>
                  </div>
                  <div class="modal-footer">
                    <!-- <button class="btn btn-primary" type="button">保存修改</button> -->
                    <button class="btn btn-default-outline" style="width:90%;" data-dismiss="modal" type="button">关闭</button>
                  </div>
                </div>
              </div>
            </div>
          

        </div>


    </body>

<script>
$(function() {

    var urlName = '{php echo $urlName}';
    showSomething(urlName);

    if ("{php echo $alert_msg}" != "") {
        $("#modal-QQ125879930").click();
    }

    //使用后清空alert_msg

});

function alertModal(str) {
    $("#p-modal-alert").html(str);
    $("#modal-QQ125879930").click();
}

function showSomething(urlName) {

    if (urlName == 'result') {
      toResult();
      return;
    }
    if (urlName == 'register') {
      $("#a-vote").removeClass("current");
      $("#a-result").removeClass("current");
      $("#a-register").addClass("current");

      $("#div-register").show();
      $("#div-header").hide();
      $("#div-vote").hide();
      $("#div-voter").hide();
      $("#div-desc").hide();
      $("#div-result").hide();
      $("#div-footer").hide();

      return;
    }

    showVote();
    return;
}

function showResult() {
    $("#a-vote").removeClass("current");
    $("#a-result").addClass("current");
    $("#a-register").removeClass("current");

    $("#div-register").hide();
    $("#div-header").show();
    $("#div-vote").hide();
    $("#div-voter").hide();
    $("#div-desc").hide();
    $("#div-result").show();
    $("#div-footer").show();
}

function showVote() {
    $("#a-vote").addClass("current");
    $("#a-result").removeClass("current");
    $("#a-register").removeClass("current");

    $("#div-register").hide();
    $("#div-header").show();
    $("#div-vote").show();
    $("#div-voter").hide();
    $("#div-desc").show();
    $("#div-result").hide();
    $("#div-footer").show();
    return;
}

function showVoter() {
    $("#a-vote").addClass("current");
    $("#a-result").removeClass("current");
    $("#a-register").removeClass("current");

    $("#div-register").hide();
    $("#div-header").show();
    $("#div-vote").hide();
    $("#div-voter").show();
    $("#div-desc").show();
    $("#div-result").hide();
    $("#div-footer").show();
    return;
}

    
function toResult() {
    var ajaxurl = "{$_W['siteroot']}{php echo $this->createMobileUrl('tresult')}";
    //alert(ajaxurl);
    var params = $("#frm-vote").serializeArray();
    //alert(params);
    $.ajax({
        type: "post",
        url: ajaxurl,
        data: params,
        dataType: "json",
        success: function (data) {
            
            if (data.resultCode == -1 || data.resultCode == 0) {//error
                alertModal(data.resultMsg);
            }
            if (data.urlName == 'result') {//voter_count,options_count,options

              $('#h5-header-voter_count').html('当前已有' + data.data.voter_count + ' 名用户参与此活动');
              $('#b-result-voter_count').html(data.data.voter_count);
              $('#b-result-options_count').html(data.data.options_count);
              $('#div-result-option').html("");
              for (var i = 0; i < data.data.options.length; i++) {
                
                if (data.data.options[i].picture != '') {
                  var img_voter_url = "{php echo $_W['attachurl']}" + data.data.options[i].picture; //这里不能用延迟加载，动态读不到JS
                  var html = "<div class='mini-layout fluid'><div class='mini-layout-sidebar'><div class='thumbnail' style='margin-bottom: 0px;'><img alt='正在加载...' width='99%' src='" + img_voter_url + "' /></div></div><div class='mini-layout-body'><p style='font-size: 16px; color: #777; text-align: left;'>" + data.data.options[i].title + "<br>排名：第" + (i+1) + "<br>票数：" + data.data.options[i].total + "<br>占比：" + data.data.options[i].proportion + "%</p></div><div style='clear:both;'></div><div class='progress progress-striped active' style='height: 30px;'><div class='progress-bar' style='width: " + data.data.options[i].proportion + "%; font-size:20px; color:#111; line-height: 30px;'>" + data.data.options[i].proportion + "%</div></div><div style='clear:both;'></div></div><hr>";
                  $('#div-result-option').append(html);
                } else {
                  var html = "<div class='mini-layout fluid'><p style='font-size: 16px; color: #777; text-align: left;'>" + data.data.options[i].title + "<br>排名：第" + (i+1) + "<br>票数：" + data.data.options[i].total + "<br>占比：" + data.data.options[i].proportion + "%</p><div class='progress progress-striped active' style='height: 30px;'><div class='progress-bar' style='width: " + data.data.options[i].proportion + "%; font-size:20px; color:#111; line-height: 30px;'>" + data.data.options[i].proportion + "%</div></div></div><div style='clear:both;'></div><hr>";
                  $('#div-result-option').append(html);
                }

                
              };

              //加载数据
              showResult();
            }
        },
        error: function(data) {
            alert("error:" + data.responseText);
        }

    });
}

function toVoter(voterNum) {
    var ajaxurl = "{$_W['siteroot']}{php echo $this->createMobileUrl('vvoter')}";
    //alert(ajaxurl);
    var params = {
        id : {php echo $id},
        oid : voterNum
    }
    //alert(params.id  + ":"+ params.oid );

    $.ajax({
        type: "post",
        url: ajaxurl,
        data: params,
        dataType: "json",
        success: function (data) {
            
            //alert(data.resultCode + " : " + data.resultMsg + " : " + data.urlName );
            
            if (data.resultCode == -1 || data.resultCode == 0) {//error
                alertModal(data.resultMsg);
            }
            if (data.urlName == 'voter') {//oid,voter_count,weivote_option
                //加载数据
                var img_voter_url = "{php echo $_W['attachurl']}" + data.data.weivote_option.picture;
                $('#img-voter').attr("src",img_voter_url);
                $('#h3-voter').html(data.data.weivote_option.title);
                $('#p-voter').html(data.data.weivote_option.description);

                $('#hid-voter-options-choose').val(data.data.oid);

                showVoter();
            }
        },
        error: function(data) {
            alert("error:" + data.responseText);
        }

    });
    return;
}

function cancelNav() {
    $("#btn-nav").click();
}

function registerSubmit() {
    var ajaxurl = "{$_W['siteroot']}{php echo $this->createMobileUrl('vregister')}";
    //alert(ajaxurl);
    var params = $("#frm-register").serializeArray();
    //alert(params);
    $.ajax({
        type: "post",
        url: ajaxurl,
        data: params,
        dataType: "json",
        success: function (data) {
            
            if (data.resultCode == -1 || data.resultCode == 0) {//error
                alertModal(data.resultMsg);
            }
            if (data.urlName != ''){
                showSomething(data.urlName);
            }
        },
        error: function(data) {
            alert("error:" + data.responseText);
        }

    });
    
    return false;
}

function voteSubmit() {
    var vote_choose = document.getElementsByName("options-choose[]");
    
    if(vote_choose.length != 0) {
        
        //alert(vote_choose.length);

        var selectindex = 0;
        for (i=0; i<vote_choose.length; i++) {
            if (vote_choose[i].checked) {
                selectindex++;
            }
        }
        var maxVote = parseInt("{php echo $weivote_setting['max_vote']}");
        if (selectindex <= 0 || selectindex > maxVote) {
            alertModal("投票数量不符合要求，请重新选择！");
      return;
        }


        ///ajax form 提交 与 php后台交互
        
        var ajaxurl = "{$_W['siteroot']}{php echo $this->createMobileUrl('vsubmit')}";
        //alert(ajaxurl);
        var params = $("#frm-vote").serializeArray();
        //alert(params);
        $.ajax({
            type: "post",
            url: ajaxurl,
            data: params,
            dataType: "json",
            success: function (data) {
                
                if (data.resultCode == -1 || data.resultCode == 0) {//error
                    alertModal(data.resultMsg);
                }
                if (data.urlName == 'result') {//voter_count,options_count,options

                  $('#b-result-voter_count').html(data.data.voter_count);
                  $('#b-result-options_count').html(data.data.options_count);
                  $('#div-result-option').html("");
                  for (var i = 0; i < data.data.options.length; i++) {
                    
                    var img_voter_url = "{php echo $_W['attachurl']}" + data.data.options[i].picture; 
                    var html = "<div class='mini-layout fluid'><div class='mini-layout-sidebar'><div class='thumbnail' style='margin-bottom: 0px;'><img alt='正在加载...' width='99%' class='Jimgload' src='./source/modules/weivote/template/mobile/assest/images/loading.gif' xsrc='" + img_voter_url + "' /></div></div><div class='mini-layout-body'><p style='font-size: 16px; color: #777; text-align: left;'>" + data.data.options[i].title + "<br>票数：" + data.data.options[i].total + "<br>占比：" + data.data.options[i].proportion + "%</p></div><div style='clear:both;'></div><div class='progress progress-striped active' style='height: 30px;'><div class='progress-bar' style='width: " + data.data.options[i].proportion + "%; font-size:20px; color:#111; line-height: 30px;'>" + data.data.options[i].proportion + "%</div></div><div style='clear:both;'></div></div>";
                      $('#div-result-option').append(html);
                  };

                  //加载数据
                  showSomething(data.urlName);
                }
            },
            error: function(data) {
                alert("error:" + data.responseText);
            }

        });
        
        return false;        
    }
    alert('服务器繁忙，请稍后再试！');
    return false; 
}

function voterSubmit() {
    //alert("voterSubmit！");
    
    var ajaxurl = "{$_W['siteroot']}{php echo $this->createMobileUrl('vsubmit')}";
    //alert(ajaxurl);
    var params = $("#frm-voter").serializeArray();
    //alert(params);
    $.ajax({
        type: "post",
        url: ajaxurl,
        data: params,
        dataType: "json",
        success: function (data) {
            
            if (data.resultCode == -1 || data.resultCode == 0) {//error
                alertModal(data.resultMsg);
            }
            if (data.urlName == 'result') {//voter_count,options_count,options

              $('#b-result-voter_count').html(data.data.voter_count);
              $('#b-result-options_count').html(data.data.options_count);
              $('#div-result-option').html("");
              for (var i = 0; i < data.data.options.length; i++) {
                
                var img_voter_url = "{php echo $_W['attachurl']}" + data.data.options[i].picture; 
                var html = "<div class='mini-layout fluid'><div class='mini-layout-sidebar'><div class='thumbnail' style='margin-bottom: 0px;'><img alt='正在加载...' width='99%' class='Jimgload' src='./source/modules/weivote/template/mobile/assest/images/loading.gif' xsrc='" + img_voter_url + "' /></div></div><div class='mini-layout-body'><p style='font-size: 16px; color: #777; text-align: left;'>" + data.data.options[i].title + "<br>票数：" + data.data.options[i].total + "<br>占比：" + data.data.options[i].proportion + "%</p></div><div style='clear:both;'></div><div class='progress progress-striped active' style='height: 30px;'><div class='progress-bar' style='width: " + data.data.options[i].proportion + "%; font-size:20px; color:#111; line-height: 30px;'>" + data.data.options[i].proportion + "%</div></div><div style='clear:both;'></div></div>";
                  $('#div-result-option').append(html);
              };

              //加载数据
              showSomething(data.urlName);
            }
        },
        error: function(data) {
            alert("error:" + data.responseText);
        }

    });
    
    return false; 
}


</script>

<script type="text/javascript">   
$(function(){
    $(window).scroll(function(){
        var screen_height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight;
        $('.Jimgload').each(function(){
            var obj_screen_top = this.getBoundingClientRect().top;
            if(obj_screen_top < screen_height){
                this.src = $(this).removeClass('Jimgload').attr('xsrc');
            }
        });
    }).scroll();
});
</script>


</html>