(function(){var b=0;var c=["webkit","moz"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16.7-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());(function(){$("body").on("touchmove",function(a){a.preventDefault()});setTimeout(function(){$("html").height($(window).height());$("html").width($(window).width());GameInit(window.requestAnimationFrame,window.cancelAnimationFrame,$)},1000);if(!/AppleWebKit.*Mobile.*/gi.test(navigator.userAgent)){alert("纺纺提醒您，请用手机打开才能玩哦！")}})();function GameInit(c,e,d){var g=createjs.Graphics;var m=createjs.Shape;var p=new createjs.Stage("game-zone");p.width=d(".game").width();p.height=d(".game").height();p.quaWidth=p.width/4;p.canvas.height=p.height;p.canvas.width=p.width;d(p.canvas).css({width:p.width+"px",height:p.height+"px"});var r=new g();r.ss(1).s(g.getRGB(0,0,0)).f(g.getRGB(200,200,30)).r(0.5,0.5,p.quaWidth,150);r=new m(r);var h=new g();h.ss(1).s(g.getRGB(0,0,0)).f(g.getRGB(255,255,255)).rect(0.5,0.5,p.quaWidth,150);h=new m(h);var j=new g();j.ss(1).s(g.getRGB(0,0,0)).f(g.getRGB(30,30,30)).r(0.5,0.5,p.quaWidth,150);j=new m(j);var a=new g();a.ss(1).s(g.getRGB(0,0,0)).f("red").r(0.5,0.5,p.quaWidth,150);a=new m(a);function l(u,s){var t=(u.toLowerCase()==="white"?h:(u==="black"?j:r)).clone();t.x=s;t.y=0;return t}l.prototype.height=150;l.prototype.width=p.quaWidth;function k(v,t,z,w){this.el=new createjs.Container();this.black=Math.floor(Math.abs(Math.random()*0.99*4));this.offset={x:t||this.black*p.quaWidth,y:z||0};for(var u=0,s=this.colNum;u<s;u++){this.el.addChild(v?l("yellow",u*p.quaWidth):(this.black===u?l("black",u*p.quaWidth):l("white",u*p.quaWidth)))}this.el.cache(0,0,this.width,this.height);this.el.y=this.offset.y;this.list.push(this);this.liveList.push(this);this.tarPos={x:this.offset.x,y:w||this.offset.y}}k.prototype.height=150;k.prototype.width=p.width;k.prototype.list=[];k.prototype.liveList=[];k.prototype.clearList=function(){var s=this.liveList;while(s.length>0){s.shift()}s=this.list;while(s.length>0){s[0].remove()}};k.prototype.colNum=4;k.prototype.add=function(){p.addChild(this.el)};k.prototype.remove=function(){p.removeChild(this.el);this.list.shift()};k.prototype.bind=function(){i.sCenter=this.offset};k.prototype.pass=function(){this.el.alpha=0.6};var i={handleEvent:function(u){u.preventDefault();u.stopPropagation();var v=u.touches;var w={x:v[v.length-1].clientX,y:v[v.length-1].clientY};var t={x:i.sCenter.x+l.prototype.width/2,y:i.sCenter.y+l.prototype.height/2},s=i.sOffset;if(w.y>=t.y-s.y&&w.y<=t.y+s.y){if(w.x>=t.x-s.x&&w.x<=t.x+s.x){i.pass()}else{if(w.y>=t.y-s.y/2&&w.y<=t.y+s.y/2){i.fail(Math.floor(w.x/p.quaWidth))}}}},tar:d("#game-zone"),sCenter:{x:-1000,y:-1000},sOffset:{x:l.prototype.width*4/5,y:l.prototype.height},pass:function(){},fail:function(){},on:function(){this.tar.on("touchstart",this.handleEvent)},off:function(){this.tar.off("touchstart",this.handleEvent)}};var n={beginTime:-1,duration:0,id:-1,init:function(){n.beginTime=-1;n.duration=0},update:function(){n.stopped=false;n.beginTime=new Date().getTime();(function s(){n.id=c(s,1000/60);n.duration=new Date().getTime()-n.beginTime;q.changeTo(n.duration)})()},stop:function(){e(n.id);this.stopped=true},stopped:true};var f={el:d(".result"),best:{el:d(".best"),data:{arcade:localStorage.getItem("arcade")||0,classic:localStorage.getItem("classic")||1000000},show:function(){var s=f.best.el;s.children("span").text(f.best.data[o.type]);s.addClass("show")},hide:function(){f.best.el.removeClass("show")},check:function(s){if(o.type==="arcade"){if(s>f.best.data.arcade){f.best.update(s)}}else{if(o.type==="classic"){if(s<f.best.data.classic){f.best.update(s)}}}},update:function(s){f.best.data[o.type]=s;localStorage.setItem(o.type,s)}},show:function(s){o.changeTo(o.type);this.el.addClass("show");s&&this.el.addClass("success");this.best.show()},hide:function(){this.el.removeClass("show success");this.best.hide()}};var q={el:d(".score"),text:new createjs.Text("0","40px Helvetica","#c8c81e"),score:0,add:function(){this.score++;return this.changeTo(this.score)},init:function(){this.el.text(this.score=0);this.text.text="0";this.text.textAlign="center";this.text.x=p.width/2;this.text.y=10;this.hide()},changeTo:function(s){q.text.text=s;p.update();q.score=s;(o.type==="arcade")&&(this.score%8===0)&&b.acc();return s},show:function(){this.el.text(this.score);this.el.addClass("show")},hide:function(){this.el.removeClass("show")}};var o={el:d(".game-mode"),title:d(".mode"),type:"arcade",show:function(){this.el.removeClass("hide")},hide:function(){this.el.addClass("hide")},changeTo:function(s){this.title.text(s.toUpperCase())}};var b=function(u,W,J,ad,s,w,D,V){var aa=0,T=12,A="arcade",K=50,v=50,ae=0,Q=u.prototype.list,E=u.prototype.liveList;var C=function(ai,af,ak,aj){var ah=D.children.length-1;D.removeChildAt(ah);var ag=new u(ai,af,ak,aj);ag.add();D.addChild(s.text)},ac=function(){D.autoClear=true;D.removeAllChildren();D.clear();s.init();J.init();X();(Q.length>0)&&Q[0].clearList();var ah=D.height,ai=l.prototype.height,af=Math.ceil(ah/ai);for(var ag=0;ag<=af;ag++){C(ag===0,0,ah-ai*(ag+1))}ab();E.shift();(A==="classic")&&(v=K-af-1)},H=function(){if(A==="arcade"&&ae===1&&E[0].offset.y>D.height){F(true);return}if(Q[0].offset.y>u.prototype.height+D.height){Q[0].remove()}for(var ag=0,af=Q.length;ag<af;ag++){Q[ag].el.y=(Q[ag].offset.y+=aa)}},ab=function(){D.update()},U=0,x=function(af){U=c(function(){x(af)},1000/60);H();ab();!!af&&af()},I=function(){e(U);(A==="classic")&&function(){for(var ag=0,af=Q.length;ag<af;ag++){Q[ag].el.y=Q[ag].offset.y=Q[ag].tarPos.y}ab()}();U=0},O=function(){return(aa<T)&&!!(aa+=0.5)},M=function(af){var ah={x:af*D.quaWidth,y:E[0].offset.y},ag={w:l.prototype.width,h:l.prototype.height};a.x=ah.x;a.y=ah.y;D.addChild(a);ab();setTimeout(function(){D.removeChild(a);ab();setTimeout(function(){D.addChild(a);ab();setTimeout(function(){D.removeChild(a);ab();setTimeout(function(){D.addChild(a);ab();setTimeout(function(){D.removeChild(a);ab()},250)},250)},250)},250)},250)},z=function(){aa=-12;x(function(){if(Q[0].offset.y<=D.height-l.prototype.height){I()}})},R=function(){var af=l.prototype.height;V(Q).each(function(ag,ah){ah.tarPos.y+=af});(U===0)&&x(function(){(Q[0].offset.y+aa>=Q[0].tarPos.y)&&I()})},P=function(){aa=8;W.pass=t;W.fail=F;W.on();E[0].bind()},t=function(){s.add();E.shift().pass();C(false,0,Q[Q.length-1].offset.y-u.prototype.height);E[0].bind();(U===0)&&x()},F=function(af){if(!(ae===1)){return}ae=2;I();ad.best.check(s.score);W.off();if(af===true){z()}else{M(af)}setTimeout(B,1500)},Y=function(){aa=25;W.pass=N;W.fail=Z;W.on();V(Q).each(function(af,ag){ag.tarPos.y=ag.offset.y});E[0].bind()},N=function(){R();E.shift().pass();J.stopped&&J.update();if(v-->0){C(false,0,Q[Q.length-1].offset.y-u.prototype.height,Q[Q.length-1].tarPos.y-u.prototype.height)}if(E.length>0){E[0].bind()}else{ae=3;J.stop();ad.best.check(J.duration);W.off();B(true)}},Z=function(af){ae=2;I();U=0;J.stop();W.off();M(af);setTimeout(B,1500)},B=function(af){ad.show(af);s.show();y()},X=function(){ad.hide();s.hide();L()},G=function(){ac();ae=1;switch(A){case"arcade":P();break;case"classic":Y();break;default:}},S=function(af){af.preventDefault();af.stopPropagation();w.hide();ad.hide();w.changeTo(w.type=A=V(af.target).data("mode"));G()},y=function(){V(".begin").on("touchstart",S)},L=function(){V(".begin").off("touchstart",S)};return{bind:y,unbind:L,acc:O}}(k,i,n,f,q,o,p,d);b.bind()};